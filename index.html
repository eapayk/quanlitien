<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Chi Tiêu - Pro Vip</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="QL Chi Tiêu">
    <meta name="application-name" content="QL Chi Tiêu">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#2c3e50">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" href="icon-192x192.png" type="image/png">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i> Đang offline - Dữ liệu sẽ được lưu tạm
    </div>
    
    <!-- PWA Install Button -->
    <button class="install-button" id="installButton">
        <i class="fas fa-download"></i> Cài App
    </button>
    
    <!-- Theme Customizer -->
    <div class="theme-customizer" id="themeCustomizer">
        <button class="theme-button" id="themeButton">
            <i class="fas fa-palette"></i>
            <span>Tuỳ chỉnh giao diện</span>
            <i class="fas fa-chevron-down"></i>
        </button>
        <div class="theme-panel" id="themePanel">
            <div class="theme-section">
                <h4><i class="fas fa-fill-drip"></i> Màu chủ đề</h4>
                <div class="color-palette" id="colorPalette"></div>
            </div>
            
            <div class="theme-section">
                <h4><i class="fas fa-image"></i> Nền trang web</h4>
                <div class="background-options">
                    <div class="background-preview" id="backgroundPreview"></div>
                    <div class="background-actions">
                        <button id="uploadBackgroundBtn">
                            <i class="fas fa-upload"></i> Tải ảnh lên
                        </button>
                        <button id="removeBackgroundBtn" class="btn-secondary">
                            <i class="fas fa-trash"></i> Xóa nền
                        </button>
                    </div>
                    <input type="file" id="backgroundInput" accept="image/*" style="display: none;">
                </div>
            </div>
            
            <div class="theme-section">
                <h4><i class="fas fa-sliders-h"></i> Độ mờ giao diện</h4>
                <div class="opacity-control">
                    <span>Mờ</span>
                    <input type="range" id="opacitySlider" min="0.1" max="1" step="0.05" value="0.95">
                    <span>Rõ</span>
                    <div class="opacity-value" id="opacityValue">95%</div>
                </div>
            </div>
            
            <div class="theme-section">
                <h4><i class="fas fa-blur"></i> Độ mờ nền ảnh</h4>
                <div class="blur-control">
                    <span>0px</span>
                    <input type="range" id="blurSlider" min="0" max="20" step="1" value="0">
                    <span>20px</span>
                    <div class="blur-value" id="blurValue">0px</div>
                </div>
            </div>
            
            <div class="theme-actions">
                <button class="btn-secondary" id="resetThemeBtn">
                    <i class="fas fa-redo"></i> Đặt lại
                </button>
                <button id="saveThemeBtn">
                    <i class="fas fa-save"></i> Áp dụng
                </button>
            </div>
        </div>
    </div>
    
    <!-- Back to App Button -->
    <button class="back-to-app" id="backToAppButton" style="display: none;">
        <i class="fas fa-arrow-left"></i> Quay lại
    </button>
    
    <!-- User Menu -->
    <div class="user-menu" id="userMenu" style="display: none;">
        <button class="user-button" id="userButton">
            <div class="user-avatar" id="userAvatar"></div>
            <span id="userName">Tài khoản</span>
            <i class="fas fa-chevron-down"></i>
        </button>
        <div class="user-dropdown" id="userDropdown">
            <div class="user-info">
                <div class="user-avatar" id="dropdownAvatar"></div>
                <h4 id="dropdownName">Tài khoản</h4>
                <p id="dropdownEmail">user@example.com</p>
            </div>
            <button class="dropdown-item" id="manageAccountBtn">
                <i class="fas fa-user-cog"></i> Quản lý tài khoản
            </button>
            <button class="dropdown-item" id="changePasswordBtn">
                <i class="fas fa-key"></i> Đổi mật khẩu
            </button>
            <button class="dropdown-item logout" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Đăng xuất
            </button>
        </div>
    </div>
    
    <!-- Authentication Container -->
    <div class="container" id="authContainer">
        <div class="auth-container">
            <div class="auth-box" id="authBox">
                <!-- Login Form -->
                <div id="loginForm">
                    <h2><i class="fas fa-sign-in-alt"></i> Đăng nhập</h2>
                    <form class="auth-form" id="loginFormElement">
                        <div class="form-group">
                            <label for="loginEmail">Email hoặc tên đăng nhập</label>
                            <input type="text" id="loginEmail" placeholder="Nhập email hoặc tên đăng nhập" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Mật khẩu</label>
                            <div class="password-input">
                                <input type="password" id="loginPassword" placeholder="Nhập mật khẩu" required>
                                <button type="button" class="toggle-password" data-target="loginPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="auth-message" id="loginMessage"></div>
                        <button type="submit" class="auth-button">
                            <i class="fas fa-sign-in-alt"></i> Đăng nhập
                        </button>
                    </form>
                    <div class="auth-links">
                        Chưa có tài khoản? <a href="#" id="showRegister">Đăng ký ngay</a>
                    </div>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" style="display: none;">
                    <h2><i class="fas fa-user-plus"></i> Đăng ký tài khoản</h2>
                    <form class="auth-form" id="registerFormElement">
                        <div class="form-group">
                            <label for="registerName">Họ và tên</label>
                            <input type="text" id="registerName" placeholder="Nhập họ và tên" required>
                        </div>
                        <div class="form-group">
                            <label for="registerEmail">Email</label>
                            <input type="email" id="registerEmail" placeholder="Nhập email" required>
                        </div>
                        <div class="form-group">
                            <label for="registerUsername">Tên đăng nhập</label>
                            <input type="text" id="registerUsername" placeholder="Nhập tên đăng nhập" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">Mật khẩu</label>
                            <div class="password-input">
                                <input type="password" id="registerPassword" placeholder="Nhập mật khẩu (ít nhất 6 ký tự)" required minlength="6">
                                <button type="button" class="toggle-password" data-target="registerPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Xác nhận mật khẩu</label>
                            <div class="password-input">
                                <input type="password" id="confirmPassword" placeholder="Nhập lại mật khẩu" required minlength="6">
                                <button type="button" class="toggle-password" data-target="confirmPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="auth-message" id="registerMessage"></div>
                        <button type="submit" class="auth-button register">
                            <i class="fas fa-user-plus"></i> Đăng ký
                        </button>
                    </form>
                    <div class="auth-links">
                        Đã có tài khoản? <a href="#" id="showLogin">Đăng nhập</a>
                    </div>
                </div>
                
                <!-- Change Password Form -->
                <div id="changePasswordForm" style="display: none;">
                    <h2><i class="fas fa-key"></i> Đổi mật khẩu</h2>
                    <form class="auth-form" id="changePasswordFormElement">
                        <div class="form-group">
                            <label for="currentPassword">Mật khẩu hiện tại</label>
                            <div class="password-input">
                                <input type="password" id="currentPassword" placeholder="Nhập mật khẩu hiện tại" required>
                                <button type="button" class="toggle-password" data-target="currentPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Mật khẩu mới</label>
                            <div class="password-input">
                                <input type="password" id="newPassword" placeholder="Nhập mật khẩu mới (ít nhất 6 ký tự)" required minlength="6">
                                <button type="button" class="toggle-password" data-target="newPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="confirmNewPassword">Xác nhận mật khẩu mới</label>
                            <div class="password-input">
                                <input type="password" id="confirmNewPassword" placeholder="Nhập lại mật khẩu mới" required minlength="6">
                                <button type="button" class="toggle-password" data-target="confirmNewPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="auth-message" id="changePasswordMessage"></div>
                        <button type="submit" class="auth-button">
                            <i class="fas fa-save"></i> Cập nhật mật khẩu
                        </button>
                    </form>
                    <div class="auth-links">
                        <a href="#" id="backToAppFromChangePassword">Quay lại ứng dụng</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Account Management Page -->
    <div class="container" id="accountManagementPage" style="display: none;">
        <div class="account-management">
            <div class="account-header">
                <h2><i class="fas fa-user-cog"></i> Quản lý tài khoản</h2>
                <p>Quản lý thông tin tài khoản và cài đặt cá nhân</p>
            </div>
            
            <div class="account-sections">
                <!-- Profile Picture Section -->
                <div class="account-section">
                    <h3 class="section-title"><i class="fas fa-user-circle"></i> Ảnh đại diện</h3>
                    <div class="profile-picture-container">
                        <div class="profile-picture" id="profilePicture"></div>
                        <div class="profile-picture-actions">
                            <button id="changePictureBtn">
                                <i class="fas fa-camera"></i> Thay đổi ảnh
                            </button>
                            <button id="removePictureBtn" class="btn-secondary">
                                <i class="fas fa-trash"></i> Xóa ảnh
                            </button>
                        </div>
                        <input type="file" id="pictureInput" accept="image/*" style="display: none;">
                    </div>
                </div>
                
                <!-- Personal Information Section -->
                <div class="account-section">
                    <h3 class="section-title"><i class="fas fa-id-card"></i> Thông tin cá nhân</h3>
                    <form class="account-form" id="personalInfoForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="accountName">Họ và tên</label>
                                <input type="text" id="accountName" placeholder="Nhập họ và tên" required>
                            </div>
                            <div class="form-group">
                                <label for="accountUsername">Tên đăng nhập</label>
                                <input type="text" id="accountUsername" placeholder="Nhập tên đăng nhập" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="accountEmail">Email liên kết</label>
                            <input type="email" id="accountEmail" placeholder="Nhập email" required>
                        </div>
                        <div class="account-actions">
                            <button type="button" class="btn-secondary" id="cancelPersonalInfo">
                                <i class="fas fa-times"></i> Hủy
                            </button>
                            <button type="submit" id="savePersonalInfo">
                                <i class="fas fa-save"></i> Lưu thay đổi
                            </button>
                        </div>
                        <div class="auth-message" id="personalInfoMessage"></div>
                    </form>
                </div>
                
                <!-- Change Password Section -->
                <div class="account-section">
                    <h3 class="section-title"><i class="fas fa-key"></i> Thay đổi mật khẩu</h3>
                    <form class="account-form" id="accountPasswordForm">
                        <div class="form-group">
                            <label for="accountCurrentPassword">Mật khẩu hiện tại</label>
                            <div class="password-input">
                                <input type="password" id="accountCurrentPassword" placeholder="Nhập mật khẩu hiện tại" required>
                                <button type="button" class="toggle-password" data-target="accountCurrentPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="accountNewPassword">Mật khẩu mới</label>
                                <div class="password-input">
                                    <input type="password" id="accountNewPassword" placeholder="Nhập mật khẩu mới" required minlength="6">
                                    <button type="button" class="toggle-password" data-target="accountNewPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="accountConfirmPassword">Xác nhận mật khẩu</label>
                                <div class="password-input">
                                    <input type="password" id="accountConfirmPassword" placeholder="Nhập lại mật khẩu mới" required minlength="6">
                                    <button type="button" class="toggle-password" data-target="accountConfirmPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="account-actions">
                            <button type="button" class="btn-secondary" id="cancelPasswordChange">
                                <i class="fas fa-times"></i> Hủy
                            </button>
                            <button type="submit" id="savePasswordChange">
                                <i class="fas fa-save"></i> Đổi mật khẩu
                            </button>
                        </div>
                        <div class="auth-message" id="passwordChangeMessage"></div>
                    </form>
                </div>
                
                <!-- Danger Zone -->
                <div class="account-section">
                    <h3 class="section-title"><i class="fas fa-exclamation-triangle"></i> Xóa tài khoản</h3>
                    <div class="delete-account">
                        <h4><i class="fas fa-trash"></i> Xóa tài khoản</h4>
                        <p>Hành động này không thể hoàn tác. Tất cả dữ liệu của bạn sẽ bị xóa vĩnh viễn.</p>
                        <button class="btn-danger" id="deleteAccountBtn">
                            <i class="fas fa-trash"></i> Xóa tài khoản
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main App Container -->
    <div class="container main-app" id="mainApp">
        <header>
            <h1><i class="fas fa-wallet"></i> QUẢN LÝ CHI TIÊU <span class="pwa-badge">EAP</span></h1>
            <p class="app-description">Xin chào, <span id="welcomeName">Người dùng</span>!</p>
        </header>
        
        <!-- PWA Status -->
        <div class="pwa-status" id="pwaStatus">
            <i class="fas fa-sync-alt"></i> Kiểm tra ...
        </div>
        
        <!-- PHẦN 1: TỔNG QUAN -->
        <section class="summary-section">
            <div class="summary-cards">
                <div class="card limit">
                    <h3>Giới hạn chi tiêu</h3>
                    <div class="amount limit-amount" id="limitAmount">0 đ</div>
                </div>
                
                <div class="card spent">
                    <h3>Đã chi tiêu</h3>
                    <div class="amount spent-amount" id="spentAmount">0 đ</div>
                </div>
                
                <div class="card remaining">
                    <h3>Số tiền còn lại</h3>
                    <div class="amount remaining-amount" id="remainingAmount">0 đ</div>
                </div>
            </div>
        </section>
        
        <!-- PHẦN 2: CHỨC NĂNG (TABS) -->
        <section class="functions-section">
            <div class="tab-header">
                <button class="tab-button active" data-tab="set-limit">
                    <i class="fas fa-cogs"></i> Thiết lập giới hạn
                </button>
                <button class="tab-button" data-tab="add-expense">
                    <i class="fas fa-plus-circle"></i> Thêm chi tiêu
                </button>
                <button class="tab-button" data-tab="manage-categories">
                    <i class="fas fa-edit"></i> Quản lý danh mục
                </button>
            </div>
            
            <div class="tab-content active" id="set-limit">
                <div class="input-box">
                    <h2><i class="fas fa-cogs"></i> Thiết lập giới hạn chi tiêu</h2>
                    <div class="form-group">
                        <label for="newLimit">Giới hạn chi tiêu tháng</label>
                        <input type="text" id="newLimit" placeholder="Ví dụ: 5m, 500k, 1000000" value="">
                    </div>
                    <button id="updateLimitBtn">
                        <i class="fas fa-save"></i> Cập nhật giới hạn
                    </button>
                </div>
            </div>
            
            <div class="tab-content" id="add-expense">
                <div class="input-box">
                    <h2><i class="fas fa-plus-circle"></i> Thêm khoản chi tiêu</h2>
                    <div class="form-group">
                        <label for="expenseCategory">Danh mục chi tiêu</label>
                        <select id="expenseCategory"></select>
                    </div>
                    <div class="form-group">
                        <label for="expenseAmount">Số tiền</label>
                        <input type="text" id="expenseAmount" placeholder="Ví dụ: 100k, 1.5m, 50000">
                    </div>
                    <div class="form-group">
                        <label for="expenseDate">Ngày chi tiêu</label>
                        <input type="date" id="expenseDate">
                    </div>
                    <button id="addExpenseBtn" class="btn-add">
                        <i class="fas fa-plus"></i> Thêm chi tiêu
                    </button>
                </div>
            </div>
            
            <div class="tab-content" id="manage-categories">
                <div class="edit-categories">
                    <h2><i class="fas fa-edit"></i> Quản lý danh mục chi tiêu</h2>
                    <p>Thêm, chỉnh sửa hoặc xóa các danh mục chi tiêu</p>
                    
                    <div class="categories-list" id="categoriesList"></div>
                    
                    <div class="add-category">
                        <div class="form-group">
                            <label for="newCategory">Tên danh mục mới</label>
                            <input type="text" id="newCategory" placeholder="Nhập tên danh mục mới">
                        </div>
                        
                        <div class="form-group icon-selector">
                            <label for="categoryIconSelect">Chọn icon cho danh mục</label>
                            <div class="current-icon-preview" id="currentIconPreview">
                                <i class="fas fa-tag" id="selectedIconPreview"></i>
                                <span>Icon đang chọn: <span id="selectedIconName">fa-tag</span></span>
                            </div>
                            <div class="icon-options" id="iconOptions"></div>
                        </div>
                        
                        <button id="addCategoryBtn" class="btn-add">
                            <i class="fas fa-plus"></i> Thêm danh mục
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- PHẦN 3: DANH SÁCH CHI TIÊU -->
        <section class="expenses-section">
            <div class="section-header">
                <h2><i class="fas fa-list"></i> Danh sách chi tiêu trong tháng</h2>
                <div class="expenses-count" id="expensesCount">0 khoản chi</div>
            </div>
            
            <div class="expenses-table-container">
                <table class="expenses-table" id="expensesTable">
                    <thead>
                        <tr>
                            <th width="60">STT</th>
                            <th>Danh mục</th>
                            <th width="180">Số tiền</th>
                            <th width="150">Ngày</th>
                            <th width="180">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTableBody"></tbody>
                </table>
            </div>
        </section>
        
        <footer>
            <p>Ứng dụng Quản Lý Chi Tiêu &copy; daominhduc08tb@gmail.com</p>
            <p><small><i class="fas fa-mobile-alt"></i> Có thể cài đặt như ứng dụng di động</small></p>
        </footer>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- JavaScript -->
    <script src="app-fixed.js"></script>
    <script>
    // Test xem JavaScript có chạy không
    console.log('✅ Script đang chạy...');
    
    // Kiểm tra xem các phần tử có tồn tại không
    document.addEventListener('DOMContentLoaded', function() {
        console.log('✅ DOM đã sẵn sàng');
        
    
        document.body.appendChild(testBtn);
        
        console.log('Các phần tử quan trọng:');
        console.log('- authContainer:', document.getElementById('authContainer'));
        console.log('- loginFormElement:', document.getElementById('loginFormElement'));
        console.log('- mainApp:', document.getElementById('mainApp'));
    });
</script>
</body>
</html>